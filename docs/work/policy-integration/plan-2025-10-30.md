# 정책 연동 심화 작업 계획 (2025-10-30)

## 목적
- 룰/우선순위/역할-프로젝트 병합 로직의 전 범위 시나리오 검증 완결
- 문서 최종화(운영 가이드/예시/트러블슈팅) 및 성능 스냅샷 부착

## 범위
- 코드: `dicom_rbac_evaluator_impl.rs`, `dicom_gateway_controller.rs`, 관련 Repository
- 테스트: 단위(우선순위/충돌/상속), 통합(게이트웨이 필터+사후 필터), 시나리오(시드 데이터 기반)
- 문서: API 문서 보강, 규칙 병합 기술 문서, 운영 가이드

## 태스크
1) 시나리오·시드 데이터
- 프로젝트 멤버십/비멤버, 명시권한(Study/Series/Instance)
- 규칙 ALLOW/DENY/LIMIT 혼합, 우선순위 충돌, 날짜 RANGE, EQ/NE/CONTAINS

2) 테스트 보강
- 단위: DENY 우선, LIMIT 교집합, 동순위 정렬, 폴백
- 통합: `/studies|/series|/instances` 요청 → QIDO 파라미터 반영 + evaluator 사후 필터 결과 검증
- E2E 유사 스텁: 토큰/프로젝트 멤버십 주입으로 외부 의존 최소화

3) 성능 검증
- 핵심 쿼리 EXPLAIN 스냅샷 수집/첨부 (인덱스 적용 경로)

4) 문서
- `docs/api/dicom-gateway-api.md`: 규칙 병합/우선순위/예외 처리 섹션 마무리, 예시 추가
- `docs/technical/rbac-rule-merge.md`: 결정 트리, 우선순위 표, 사례별 요청/응답
- 운영 가이드: 규칙 설계 Best Practice, 디버깅 절차

5) 품질
- doctest: ignore→no_run/실행가능 예제로 점진 전환 후 재활성
- 경고 감소(사용되지 않는 항목 정리)

## 산출물
- 보강된 테스트 세트(전부 그린)
- 문서 2개 섹션 보강 + 1개 가이드 보강
- EXPLAIN 스냅샷
- CHANGELOG 업데이트

## 일정(안)
- D+0: 시나리오/시드/테스트 스켈레톤
- D+1: 통합/성능/문서 1차
- D+2: 품질 게이트(도큐/경고 정리), 마감
