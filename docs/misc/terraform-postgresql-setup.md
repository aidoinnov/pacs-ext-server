# üêò TerraformÏúºÎ°ú PostgreSQL Íµ¨ÏÑ±ÌïòÍ∏∞

PACS Extension Server ÌîÑÎ°úÏ†ùÌä∏Ïùò PostgreSQL Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º TerraformÏúºÎ°ú Íµ¨ÏÑ±ÌïòÎäî Ïã§Ïäµ Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§.

## üìã Î™©Ï∞®

1. [ÌîÑÎ°úÏ†ùÌä∏ Íµ¨Ï°∞ ÏÑ§Ï†ï](#ÌîÑÎ°úÏ†ùÌä∏-Íµ¨Ï°∞-ÏÑ§Ï†ï)
2. [Í∏∞Î≥∏ PostgreSQL Íµ¨ÏÑ±](#Í∏∞Î≥∏-postgresql-Íµ¨ÏÑ±)
3. [Í≥†Í∏â ÏÑ§Ï†ï Î∞è ÏµúÏ†ÅÌôî](#Í≥†Í∏â-ÏÑ§Ï†ï-Î∞è-ÏµúÏ†ÅÌôî)
4. [ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï Î∂ÑÎ¶¨](#ÌôòÍ≤ΩÎ≥Ñ-ÏÑ§Ï†ï-Î∂ÑÎ¶¨)
5. [Ïã§Ïäµ Î∞è ÌÖåÏä§Ìä∏](#Ïã§Ïäµ-Î∞è-ÌÖåÏä§Ìä∏)
6. [Î¨∏Ï†ú Ìï¥Í≤∞](#Î¨∏Ï†ú-Ìï¥Í≤∞)

---

## üèóÔ∏è ÌîÑÎ°úÏ†ùÌä∏ Íµ¨Ï°∞ ÏÑ§Ï†ï

### ÎîîÎ†âÌÜ†Î¶¨ Íµ¨Ï°∞
```
terraform-postgres/
‚îú‚îÄ‚îÄ main.tf                 # Î©îÏù∏ Î¶¨ÏÜåÏä§ Ï†ïÏùò
‚îú‚îÄ‚îÄ variables.tf            # Î≥ÄÏàò Ï†ïÏùò
‚îú‚îÄ‚îÄ outputs.tf             # Ï∂úÎ†•Í∞í Ï†ïÏùò
‚îú‚îÄ‚îÄ terraform.tfvars       # Î≥ÄÏàò Í∞í ÏÑ§Ï†ï
‚îú‚îÄ‚îÄ versions.tf            # Provider Î≤ÑÏ†Ñ Í¥ÄÎ¶¨
‚îú‚îÄ‚îÄ modules/               # Ïû¨ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™®Îìà
‚îÇ   ‚îî‚îÄ‚îÄ postgres/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ       ‚îú‚îÄ‚îÄ outputs.tf
‚îÇ       ‚îî‚îÄ‚îÄ versions.tf
‚îî‚îÄ‚îÄ environments/          # ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï
    ‚îú‚îÄ‚îÄ development/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
    ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
    ‚îî‚îÄ‚îÄ production/
        ‚îú‚îÄ‚îÄ main.tf
        ‚îî‚îÄ‚îÄ terraform.tfvars
```

### Ï¥àÍ∏∞ ÏÑ§Ï†ï

#### `versions.tf`
```hcl
terraform {
  required_version = ">= 1.0"
  
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "~> 3.0"
    }
  }
}
```

---

## üêò Í∏∞Î≥∏ PostgreSQL Íµ¨ÏÑ±

### 1. Î©îÏù∏ Î¶¨ÏÜåÏä§ Ï†ïÏùò

#### `main.tf`
```hcl
# Docker Provider ÏÑ§Ï†ï
provider "docker" {
  host = "unix:///var/run/docker.sock"
}

# PostgreSQL Ïù¥ÎØ∏ÏßÄ
resource "docker_image" "postgres" {
  name = "postgres:16-alpine"
  
  keep_locally = false
}

# Îç∞Ïù¥ÌÑ∞ Î≥ºÎ•®
resource "docker_volume" "postgres_data" {
  name = "${var.project_name}-postgres-data"
  
  driver = "local"
}

# PostgreSQL Ïª®ÌÖåÏù¥ÎÑà
resource "docker_container" "postgres" {
  name  = "${var.project_name}-postgres"
  image = docker_image.postgres.image_id
  
  # ÌôòÍ≤ΩÎ≥ÄÏàò
  env = [
    "POSTGRES_USER=${var.postgres_user}",
    "POSTGRES_PASSWORD=${var.postgres_password}",
    "POSTGRES_DB=${var.postgres_db}",
    "POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
  ]
  
  # Ìè¨Ìä∏ Îß§Ìïë
  ports {
    internal = 5432
    external = var.postgres_port
  }
  
  # Î≥ºÎ•® ÎßàÏö¥Ìä∏
  volumes {
    volume_name    = docker_volume.postgres_data.name
    container_path = "/var/lib/postgresql/data"
  }
  
  # Ïû¨ÏãúÏûë Ï†ïÏ±Ö
  restart = "unless-stopped"
  
  # Ìó¨Ïä§Ï≤¥ÌÅ¨
  healthcheck {
    test     = ["CMD-SHELL", "pg_isready -U ${var.postgres_user} -d ${var.postgres_db}"]
    interval = "10s"
    timeout  = "5s"
    retries  = 5
    start_period = "30s"
  }
  
  # ÎùºÎ≤®
  labels {
    label = "project"
    value = var.project_name
  }
  
  labels {
    label = "environment"
    value = var.environment
  }
  
  labels {
    label = "service"
    value = "postgresql"
  }
}
```

### 2. Î≥ÄÏàò Ï†ïÏùò

#### `variables.tf`
```hcl
# ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï
variable "project_name" {
  description = "Name of the project"
  type        = string
  default     = "pacs"
}

variable "environment" {
  description = "Environment (development, staging, production)"
  type        = string
  default     = "development"
  
  validation {
    condition     = contains(["development", "staging", "production"], var.environment)
    error_message = "Environment must be one of: development, staging, production."
  }
}

# PostgreSQL ÏÑ§Ï†ï
variable "postgres_user" {
  description = "PostgreSQL username"
  type        = string
  default     = "admin"
}

variable "postgres_password" {
  description = "PostgreSQL password"
  type        = string
  sensitive   = true
  default     = "admin123"
}

variable "postgres_db" {
  description = "PostgreSQL database name"
  type        = string
  default     = "pacs_db"
}

variable "postgres_port" {
  description = "PostgreSQL port"
  type        = number
  default     = 5432
  
  validation {
    condition     = var.postgres_port > 1024 && var.postgres_port < 65536
    error_message = "PostgreSQL port must be between 1024 and 65535."
  }
}

# Ïª®ÌÖåÏù¥ÎÑà ÏÑ§Ï†ï
variable "container_restart_policy" {
  description = "Container restart policy"
  type        = string
  default     = "unless-stopped"
  
  validation {
    condition     = contains(["no", "on-failure", "always", "unless-stopped"], var.container_restart_policy)
    error_message = "Restart policy must be one of: no, on-failure, always, unless-stopped."
  }
}

# Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏÑ§Ï†ï
variable "healthcheck_interval" {
  description = "Health check interval"
  type        = string
  default     = "10s"
}

variable "healthcheck_timeout" {
  description = "Health check timeout"
  type        = string
  default     = "5s"
}

variable "healthcheck_retries" {
  description = "Health check retries"
  type        = number
  default     = 5
}

variable "healthcheck_start_period" {
  description = "Health check start period"
  type        = string
  default     = "30s"
}
```

### 3. Ï∂úÎ†•Í∞í Ï†ïÏùò

#### `outputs.tf`
```hcl
# Ïª®ÌÖåÏù¥ÎÑà Ï†ïÎ≥¥
output "postgres_container_name" {
  description = "Name of the PostgreSQL container"
  value       = docker_container.postgres.name
}

output "postgres_container_id" {
  description = "ID of the PostgreSQL container"
  value       = docker_container.postgres.id
}

# ÎÑ§Ìä∏ÏõåÌÅ¨ Ï†ïÎ≥¥
output "postgres_host" {
  description = "PostgreSQL host"
  value       = "localhost"
}

output "postgres_port" {
  description = "PostgreSQL port"
  value       = docker_container.postgres.ports[0].external
}

# Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ïÎ≥¥
output "postgres_database" {
  description = "PostgreSQL database name"
  value       = var.postgres_db
}

output "postgres_user" {
  description = "PostgreSQL username"
  value       = var.postgres_user
}

# Ïó∞Í≤∞ Ï†ïÎ≥¥
output "postgres_connection_string" {
  description = "PostgreSQL connection string"
  value       = "postgresql://${var.postgres_user}:${var.postgres_password}@localhost:${docker_container.postgres.ports[0].external}/${var.postgres_db}"
  sensitive   = true
}

# Î≥ºÎ•® Ï†ïÎ≥¥
output "postgres_volume_name" {
  description = "Name of the PostgreSQL data volume"
  value       = docker_volume.postgres_data.name
}

# Ìó¨Ïä§Ï≤¥ÌÅ¨ Ï†ïÎ≥¥
output "postgres_health_status" {
  description = "PostgreSQL health status"
  value       = docker_container.postgres.health
}
```

### 4. Î≥ÄÏàò Í∞í ÏÑ§Ï†ï

#### `terraform.tfvars`
```hcl
# ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï
project_name = "pacs"
environment  = "development"

# PostgreSQL ÏÑ§Ï†ï
postgres_user     = "admin"
postgres_password = "admin123"
postgres_db       = "pacs_db"
postgres_port     = 5432

# Ïª®ÌÖåÏù¥ÎÑà ÏÑ§Ï†ï
container_restart_policy = "unless-stopped"

# Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏÑ§Ï†ï
healthcheck_interval    = "10s"
healthcheck_timeout     = "5s"
healthcheck_retries     = 5
healthcheck_start_period = "30s"
```

---

## üöÄ Í≥†Í∏â ÏÑ§Ï†ï Î∞è ÏµúÏ†ÅÌôî

### 1. ÎÑ§Ìä∏ÏõåÌÅ¨ Íµ¨ÏÑ±

#### `network.tf`
```hcl
# Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÎÑ§Ìä∏ÏõåÌÅ¨
resource "docker_network" "pacs_network" {
  name = "${var.project_name}-network"
  
  driver = "bridge"
  
  ipam_config {
    subnet = "172.20.0.0/16"
  }
  
  labels {
    label = "project"
    value = var.project_name
  }
}

# PostgreSQL Ïª®ÌÖåÏù¥ÎÑà (ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞)
resource "docker_container" "postgres" {
  # ... Í∏∞Ï°¥ ÏÑ§Ï†ï ...
  
  networks_advanced {
    name = docker_network.pacs_network.name
  }
  
  # Ïô∏Î∂Ä Ìè¨Ìä∏ ÎÖ∏Ï∂ú Ï†úÍ±∞ (ÎÇ¥Î∂Ä ÎÑ§Ìä∏ÏõåÌÅ¨ÏóêÏÑúÎßå Ï†ëÍ∑º)
  # ports Î∏îÎ°ù Ï†úÍ±∞
}
```

### 2. Î∞±ÏóÖ ÏÑ§Ï†ï

#### `backup.tf`
```hcl
# Î∞±ÏóÖ Î≥ºÎ•®
resource "docker_volume" "backup_data" {
  name = "${var.project_name}-backup-data"
  
  driver = "local"
}

# Î∞±ÏóÖ Ïª®ÌÖåÏù¥ÎÑà
resource "docker_container" "backup" {
  name  = "${var.project_name}-backup"
  image = "postgres:16-alpine"
  
  command = [
    "sh", "-c",
    "while true; do pg_dump -h ${docker_container.postgres.name} -U ${var.postgres_user} -d ${var.postgres_db} > /backup/backup_$(date +%Y%m%d_%H%M%S).sql; sleep 86400; done"
  ]
  
  volumes {
    volume_name    = docker_volume.backup_data.name
    container_path = "/backup"
  }
  
  networks_advanced {
    name = docker_network.pacs_network.name
  }
  
  depends_on = [docker_container.postgres]
  
  restart = "unless-stopped"
  
  labels {
    label = "project"
    value = var.project_name
  }
  
  labels {
    label = "service"
    value = "backup"
  }
}
```

### 3. Î™®ÎãàÌÑ∞ÎßÅ ÏÑ§Ï†ï

#### `monitoring.tf`
```hcl
# Prometheus ÏÑ§Ï†ï
resource "docker_container" "prometheus" {
  name  = "${var.project_name}-prometheus"
  image = "prom/prometheus:latest"
  
  ports {
    internal = 9090
    external = 9090
  }
  
  volumes {
    volume_name    = docker_volume.prometheus_data.name
    container_path = "/prometheus"
  }
  
  networks_advanced {
    name = docker_network.pacs_network.name
  }
  
  restart = "unless-stopped"
  
  labels {
    label = "project"
    value = var.project_name
  }
  
  labels {
    label = "service"
    value = "prometheus"
  }
}

# Grafana ÏÑ§Ï†ï
resource "docker_container" "grafana" {
  name  = "${var.project_name}-grafana"
  image = "grafana/grafana:latest"
  
  ports {
    internal = 3000
    external = 3000
  }
  
  volumes {
    volume_name    = docker_volume.grafana_data.name
    container_path = "/var/lib/grafana"
  }
  
  networks_advanced {
    name = docker_network.pacs_network.name
  }
  
  restart = "unless-stopped"
  
  env = [
    "GF_SECURITY_ADMIN_PASSWORD=admin123"
  ]
  
  labels {
    label = "project"
    value = var.project_name
  }
  
  labels {
    label = "service"
    value = "grafana"
  }
}

# Î™®ÎãàÌÑ∞ÎßÅ Î≥ºÎ•®Îì§
resource "docker_volume" "prometheus_data" {
  name = "${var.project_name}-prometheus-data"
}

resource "docker_volume" "grafana_data" {
  name = "${var.project_name}-grafana-data"
}
```

---

## üåç ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï Î∂ÑÎ¶¨

### 1. Î™®Îìà Íµ¨Ï°∞

#### `modules/postgres/main.tf`
```hcl
# PostgreSQL Ïù¥ÎØ∏ÏßÄ
resource "docker_image" "postgres" {
  name = "postgres:16-alpine"
}

# Îç∞Ïù¥ÌÑ∞ Î≥ºÎ•®
resource "docker_volume" "postgres_data" {
  name = "${var.project_name}-postgres-data-${var.environment}"
}

# PostgreSQL Ïª®ÌÖåÏù¥ÎÑà
resource "docker_container" "postgres" {
  name  = "${var.project_name}-postgres-${var.environment}"
  image = docker_image.postgres.image_id
  
  env = [
    "POSTGRES_USER=${var.postgres_user}",
    "POSTGRES_PASSWORD=${var.postgres_password}",
    "POSTGRES_DB=${var.postgres_db}",
    "POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
  ]
  
  ports {
    internal = 5432
    external = var.postgres_port
  }
  
  volumes {
    volume_name    = docker_volume.postgres_data.name
    container_path = "/var/lib/postgresql/data"
  }
  
  restart = var.container_restart_policy
  
  healthcheck {
    test         = ["CMD-SHELL", "pg_isready -U ${var.postgres_user} -d ${var.postgres_db}"]
    interval     = var.healthcheck_interval
    timeout      = var.healthcheck_timeout
    retries      = var.healthcheck_retries
    start_period = var.healthcheck_start_period
  }
  
  labels = {
    project     = var.project_name
    environment = var.environment
    service     = "postgresql"
  }
}
```

#### `modules/postgres/variables.tf`
```hcl
# ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï
variable "project_name" {
  description = "Name of the project"
  type        = string
}

variable "environment" {
  description = "Environment"
  type        = string
}

# PostgreSQL ÏÑ§Ï†ï
variable "postgres_user" {
  description = "PostgreSQL username"
  type        = string
}

variable "postgres_password" {
  description = "PostgreSQL password"
  type        = string
  sensitive   = true
}

variable "postgres_db" {
  description = "PostgreSQL database name"
  type        = string
}

variable "postgres_port" {
  description = "PostgreSQL port"
  type        = number
}

# Ïª®ÌÖåÏù¥ÎÑà ÏÑ§Ï†ï
variable "container_restart_policy" {
  description = "Container restart policy"
  type        = string
  default     = "unless-stopped"
}

# Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏÑ§Ï†ï
variable "healthcheck_interval" {
  description = "Health check interval"
  type        = string
  default     = "10s"
}

variable "healthcheck_timeout" {
  description = "Health check timeout"
  type        = string
  default     = "5s"
}

variable "healthcheck_retries" {
  description = "Health check retries"
  type        = number
  default     = 5
}

variable "healthcheck_start_period" {
  description = "Health check start period"
  type        = string
  default     = "30s"
}
```

#### `modules/postgres/outputs.tf`
```hcl
output "postgres_container_name" {
  description = "Name of the PostgreSQL container"
  value       = docker_container.postgres.name
}

output "postgres_container_id" {
  description = "ID of the PostgreSQL container"
  value       = docker_container.postgres.id
}

output "postgres_port" {
  description = "PostgreSQL port"
  value       = docker_container.postgres.ports[0].external
}

output "postgres_volume_name" {
  description = "Name of the PostgreSQL data volume"
  value       = docker_volume.postgres_data.name
}
```

### 2. ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï

#### `environments/development/main.tf`
```hcl
module "postgres" {
  source = "../../modules/postgres"
  
  project_name = "pacs"
  environment  = "development"
  
  postgres_user     = "admin"
  postgres_password = "admin123"
  postgres_db       = "pacs_db_dev"
  postgres_port     = 5432
  
  container_restart_policy = "unless-stopped"
  
  healthcheck_interval    = "10s"
  healthcheck_timeout     = "5s"
  healthcheck_retries     = 5
  healthcheck_start_period = "30s"
}
```

#### `environments/development/terraform.tfvars`
```hcl
# Development ÌôòÍ≤Ω ÏÑ§Ï†ï
project_name = "pacs"
environment  = "development"

postgres_user     = "admin"
postgres_password = "admin123"
postgres_db       = "pacs_db_dev"
postgres_port     = 5432
```

#### `environments/production/main.tf`
```hcl
module "postgres" {
  source = "../../modules/postgres"
  
  project_name = "pacs"
  environment  = "production"
  
  postgres_user     = "pacs_admin"
  postgres_password = var.postgres_password  # ÏãúÌÅ¨Î¶øÏóêÏÑú Í∞ÄÏ†∏Ïò¥
  postgres_db       = "pacs_db_prod"
  postgres_port     = 5432
  
  container_restart_policy = "always"
  
  healthcheck_interval    = "5s"
  healthcheck_timeout     = "3s"
  healthcheck_retries     = 3
  healthcheck_start_period = "60s"
}
```

---

## üß™ Ïã§Ïäµ Î∞è ÌÖåÏä§Ìä∏

### 1. Í∏∞Î≥∏ Íµ¨ÏÑ± ÌÖåÏä§Ìä∏

#### Îã®Í≥Ñ 1: ÌîÑÎ°úÏ†ùÌä∏ Ï¥àÍ∏∞Ìôî
```bash
# ÌîÑÎ°úÏ†ùÌä∏ ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±
mkdir terraform-postgres
cd terraform-postgres

# Terraform ÌååÏùºÎì§ ÏÉùÏÑ± (ÏúÑÏùò ÏΩîÎìú ÏÇ¨Ïö©)
```

#### Îã®Í≥Ñ 2: Terraform Ïã§Ìñâ
```bash
# Ï¥àÍ∏∞Ìôî
terraform init

# Í≥ÑÌöç ÌôïÏù∏
terraform plan

# Ï†ÅÏö©
terraform apply
```

#### Îã®Í≥Ñ 3: Í≤∞Í≥º ÌôïÏù∏
```bash
# Ïª®ÌÖåÏù¥ÎÑà ÌôïÏù∏
docker ps

# Î≥ºÎ•® ÌôïÏù∏
docker volume ls

# ÎÑ§Ìä∏ÏõåÌÅ¨ ÌôïÏù∏
docker network ls

# Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
docker exec -it pacs-postgres psql -U admin -d pacs_db
```

### 2. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ ÌÖåÏä§Ìä∏

#### Ïó∞Í≤∞ ÌÖåÏä§Ìä∏ Ïä§ÌÅ¨Î¶ΩÌä∏
```bash
#!/bin/bash
# test_connection.sh

echo "Testing PostgreSQL connection..."

# Ïª®ÌÖåÏù¥ÎÑà ÏÉÅÌÉú ÌôïÏù∏
if docker ps | grep -q "pacs-postgres"; then
    echo "‚úÖ PostgreSQL container is running"
else
    echo "‚ùå PostgreSQL container is not running"
    exit 1
fi

# Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ ÌÖåÏä§Ìä∏
if docker exec pacs-postgres pg_isready -U admin -d pacs_db; then
    echo "‚úÖ PostgreSQL is ready to accept connections"
else
    echo "‚ùå PostgreSQL is not ready"
    exit 1
fi

# ÌÖåÏù¥Î∏î ÏÉùÏÑ± ÌÖåÏä§Ìä∏
docker exec pacs-postgres psql -U admin -d pacs_db -c "
CREATE TABLE IF NOT EXISTS test_table (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
"

if [ $? -eq 0 ]; then
    echo "‚úÖ Database operations successful"
else
    echo "‚ùå Database operations failed"
    exit 1
fi

echo "üéâ All tests passed!"
```

### 3. ÏÑ±Îä• ÌÖåÏä§Ìä∏

#### ÏÑ±Îä• ÌÖåÏä§Ìä∏ Ïä§ÌÅ¨Î¶ΩÌä∏
```bash
#!/bin/bash
# performance_test.sh

echo "Running PostgreSQL performance test..."

# Ïó∞Í≤∞ ÏãúÍ∞Ñ ÌÖåÏä§Ìä∏
time docker exec pacs-postgres psql -U admin -d pacs_db -c "SELECT 1;"

# ÎåÄÎüâ Îç∞Ïù¥ÌÑ∞ ÏÇΩÏûÖ ÌÖåÏä§Ìä∏
docker exec pacs-postgres psql -U admin -d pacs_db -c "
INSERT INTO test_table (name) 
SELECT 'test_' || generate_series(1, 10000);
"

# ÏøºÎ¶¨ ÏÑ±Îä• ÌÖåÏä§Ìä∏
time docker exec pacs-postgres psql -U admin -d pacs_db -c "
SELECT COUNT(*) FROM test_table;
"

echo "Performance test completed!"
```

---

## üîß Î¨∏Ï†ú Ìï¥Í≤∞

### 1. Ïª®ÌÖåÏù¥ÎÑà ÏãúÏûë Ïã§Ìå®

**Ï¶ùÏÉÅ**: Ïª®ÌÖåÏù¥ÎÑàÍ∞Ä ÏãúÏûëÎêòÏßÄ ÏïäÏùå
```bash
# Ïª®ÌÖåÏù¥ÎÑà Î°úÍ∑∏ ÌôïÏù∏
docker logs pacs-postgres

# Ïª®ÌÖåÏù¥ÎÑà ÏÉÅÌÉú ÌôïÏù∏
docker inspect pacs-postgres
```

**Ìï¥Í≤∞ Î∞©Î≤ï**:
```hcl
# ÌôòÍ≤ΩÎ≥ÄÏàò Í≤ÄÏ¶ù Ï∂îÍ∞Ä
resource "docker_container" "postgres" {
  # ... Í∏∞Ï°¥ ÏÑ§Ï†ï ...
  
  # ÌôòÍ≤ΩÎ≥ÄÏàò Í≤ÄÏ¶ù
  env = [
    "POSTGRES_USER=${var.postgres_user}",
    "POSTGRES_PASSWORD=${var.postgres_password}",
    "POSTGRES_DB=${var.postgres_db}",
    "POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
  ]
  
  # ÏãúÏûë ÎåÄÍ∏∞ ÏãúÍ∞Ñ Ï¶ùÍ∞Ä
  healthcheck {
    test         = ["CMD-SHELL", "pg_isready -U ${var.postgres_user} -d ${var.postgres_db}"]
    interval     = "10s"
    timeout      = "5s"
    retries      = 10  # Ïû¨ÏãúÎèÑ ÌöüÏàò Ï¶ùÍ∞Ä
    start_period = "60s"  # ÏãúÏûë ÎåÄÍ∏∞ ÏãúÍ∞Ñ Ï¶ùÍ∞Ä
  }
}
```

### 2. Ìè¨Ìä∏ Ï∂©Îèå

**Ï¶ùÏÉÅ**: Ìè¨Ìä∏Í∞Ä Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ë
```bash
# Ìè¨Ìä∏ ÏÇ¨Ïö© ÌôïÏù∏
netstat -tulpn | grep :5432
lsof -i :5432
```

**Ìï¥Í≤∞ Î∞©Î≤ï**:
```hcl
# Îã§Î•∏ Ìè¨Ìä∏ ÏÇ¨Ïö©
variable "postgres_port" {
  description = "PostgreSQL port"
  type        = number
  default     = 5433  # 5432 ÎåÄÏã† 5433 ÏÇ¨Ïö©
}
```

### 3. Î≥ºÎ•® Í∂åÌïú Î¨∏Ï†ú

**Ï¶ùÏÉÅ**: Î≥ºÎ•® ÎßàÏö¥Ìä∏ Ïã§Ìå®
```bash
# Î≥ºÎ•® Ï†ïÎ≥¥ ÌôïÏù∏
docker volume inspect pacs-postgres-data
```

**Ìï¥Í≤∞ Î∞©Î≤ï**:
```hcl
# Î≥ºÎ•® ÎìúÎùºÏù¥Î≤Ñ ÏòµÏÖò ÏÑ§Ï†ï
resource "docker_volume" "postgres_data" {
  name = "${var.project_name}-postgres-data"
  
  driver = "local"
  
  driver_opts = {
    type   = "none"
    o      = "bind"
    device = "/var/lib/docker/volumes/${var.project_name}-postgres-data/_data"
  }
}
```

### 4. ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞ Î¨∏Ï†ú

**Ï¶ùÏÉÅ**: Ïª®ÌÖåÏù¥ÎÑà Í∞Ñ ÌÜµÏã† Ïã§Ìå®
```bash
# ÎÑ§Ìä∏ÏõåÌÅ¨ ÌôïÏù∏
docker network ls
docker network inspect pacs-network
```

**Ìï¥Í≤∞ Î∞©Î≤ï**:
```hcl
# ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÑ§Ï†ï ÌôïÏù∏
resource "docker_network" "pacs_network" {
  name = "${var.project_name}-network"
  
  driver = "bridge"
  
  ipam_config {
    subnet = "172.20.0.0/16"
    gateway = "172.20.0.1"
  }
}
```

---

## üìä Î™®ÎãàÌÑ∞ÎßÅ Î∞è Î°úÍπÖ

### 1. Î°úÍ∑∏ ÏàòÏßë

```bash
# Ïª®ÌÖåÏù¥ÎÑà Î°úÍ∑∏ ÌôïÏù∏
docker logs pacs-postgres

# Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ Î™®ÎãàÌÑ∞ÎßÅ
docker logs -f pacs-postgres

# Î°úÍ∑∏ ÌååÏùºÎ°ú Ï†ÄÏû•
docker logs pacs-postgres > postgres.log 2>&1
```

### 2. ÏÑ±Îä• Î™®ÎãàÌÑ∞ÎßÅ

```bash
# Ïª®ÌÖåÏù¥ÎÑà Î¶¨ÏÜåÏä§ ÏÇ¨Ïö©Îüâ ÌôïÏù∏
docker stats pacs-postgres

# Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏÑ±Îä• ÌôïÏù∏
docker exec pacs-postgres psql -U admin -d pacs_db -c "
SELECT 
    datname,
    numbackends,
    xact_commit,
    xact_rollback,
    blks_read,
    blks_hit
FROM pg_stat_database 
WHERE datname = 'pacs_db';
"
```

### 3. Ìó¨Ïä§Ï≤¥ÌÅ¨ Î™®ÎãàÌÑ∞ÎßÅ

```bash
# Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏÉÅÌÉú ÌôïÏù∏
docker inspect pacs-postgres | jq '.[0].State.Health'

# Ìó¨Ïä§Ï≤¥ÌÅ¨ Î°úÍ∑∏ ÌôïÏù∏
docker inspect pacs-postgres | jq '.[0].State.Health.Log'
```

---

## üìö Îã§Ïùå Îã®Í≥Ñ

Ïù¥Ï†ú PostgreSQLÏùÑ TerraformÏúºÎ°ú ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Íµ¨ÏÑ±ÌñàÏúºÎãà Îã§Ïùå Î¨∏ÏÑúÎì§ÏùÑ ÌïôÏäµÌïòÏÑ∏Ïöî:

1. **Docker ÎÑ§Ìä∏ÏõåÌÅ¨ Íµ¨ÏÑ±** - Ïª®ÌÖåÏù¥ÎÑà Í∞Ñ ÌÜµÏã† ÏÑ§Ï†ï
2. **ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï Í¥ÄÎ¶¨** - development/production Î∂ÑÎ¶¨
3. **AWS S3 Î≤ÑÌÇ∑ Íµ¨ÏÑ±** - Object Storage ÏÑ§Ï†ï

---

## üìñ Ï∞∏Í≥† ÏûêÎ£å

- [PostgreSQL Í≥µÏãù Î¨∏ÏÑú](https://www.postgresql.org/docs/)
- [Docker PostgreSQL Ïù¥ÎØ∏ÏßÄ](https://hub.docker.com/_/postgres)
- [Terraform Docker Provider](https://registry.terraform.io/providers/kreuzwerker/docker/latest/docs)

Ïù¥Ï†ú PACS ÌîÑÎ°úÏ†ùÌä∏Ïùò PostgreSQLÏùÑ TerraformÏúºÎ°ú ÏôÑÏ†ÑÌûà Í¥ÄÎ¶¨Ìï† Ïàò ÏûàÍ≤å ÎêòÏóàÏäµÎãàÎã§! üöÄ
