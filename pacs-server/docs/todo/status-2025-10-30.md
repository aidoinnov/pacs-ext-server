# TODO Snapshot (2025-10-30)

- [x] Create/complete SQL migrations for RBAC gateway expansions (017 and enums ok)
- [ ] Implement repositories: institutions (InstitutionRepositoryImpl methods)
- [x] Combined RBAC evaluator: priority/inheritance/rule-merge 구현 (caching 보류)
- [ ] Map access_condition to QIDO params and JSON paths (태그/연산자 확장)
- [x] DB indices 적용(018_core_indices.sql) — rule 조회/게이트웨이/동기화 경로 가속
- [ ] Settings: dcm4chee 설정 정리 및 prod 검증(모드 full/api-only/sync-only 동작 OK)
- [~] Tests: 대다수 테스트 작업은 백로그로 이동(현 시점 범위 외)
- [x] API docs: /instances 및 RBAC 필터링 문서 반영
- [~] Legacy tests 재활성화: 장기 백로그로 이동
- [~] Seed 데이터/EXPLAIN 스냅샷 수집 완료, 별도 벤치마크 보고서는 백로그에 정리
- [ ] Doctests: ignored → no_run/실행 가능 예제로 전환
- [x] Compiler warnings: 1차 정리 완료(잔여 경고는 추후 정리)

---

## 한 눈에 보는 진행 상태

✅ 완료
- RBAC 스키마 확장: project_data_study/series/instance 추가, 관계 모델(UID↔study_id/series_id) 구축, 룰/연계 테이블(security_*_dicom_condition) 추가
- 동기화 엔진: 스케줄러/워커 구현, 델타 동기화(updated_time), 매핑(Study/Series/Instance), 인터벌 환경설정(SERVER_MODE/sync.interval)
- DICOM 게이트웨이: /api/dicom/studies|series|instances 구현, Keycloak 토큰 릴레이, evaluator 기반 사후 필터링
- RBAC evaluator: 프로젝트 멤버십/명시적 권한/규칙 기반 평가 로직, 단위테스트
- 테스트 안정화: 핵심 단위·시나리오(선별) 그린 유지, 무거운 항목은 백로그로 이동
- 서버 모드/설정: full/api-only/sync-only, Dcm4chee DB 설정 경로 추가
- 인덱스 최적화: 018_core_indices.sql 적용, EXPLAIN 스냅샷 수집 자동화

🟡 부분 완료
- 정책 연동 심화: 병합/우선순위 구현 완료, 전 범위 시나리오·문서 보강 일부 진행
- QIDO 필터/페이지네이션: Modality/PatientID/StudyDate 매핑, 일부 태그/연산자 확장 필요(페이지네이션 미구현)
- 로깅/메트릭: 로그는 있음, 메트릭/대시보드 없음
- Settings 검증: prod 환경 검증 대기

⛔ 미완료
- RBAC 자체 DICOMweb API(/dicomweb/studies/series/instances) — dcm4chee 비의존 DB 기반 제공
- 프론트엔드 연동(허용 데이터만 렌더, 역할별 UI 제어, 에러 UX)
- dcm4chee 이벤트 훅 기반 실시간 동기화(Webhook/Retry/Queue)
- 모니터링/알림(Prometheus/Grafana/Slack 등)

추가 메모
- 테스트 작업 백로그: `pacs-server/todo/testing-backlog-2025-10-30.md` 참조
- EXPLAIN 스냅샷 자동화 테스트는 `APP_DATABASE_URL` 설정 시 동작
- 동기화 DB 포트는 실행 시 환경변수로 설정 가능하며, 기존 세션 포트 충돌로 서버가 바로 종료된 케이스가 있었습니다(8080 점유). 필요 시 기존 프로세스 종료 후 재실행하면 됩니다.
